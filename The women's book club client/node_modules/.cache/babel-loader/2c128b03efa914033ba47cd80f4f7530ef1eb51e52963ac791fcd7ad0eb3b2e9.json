{"ast":null,"code":"export default {\n  name: 'UserInfo',\n  data() {\n    return {\n      dialogFormVisible: false,\n      onEdit: false,\n      user: {\n        userId: '',\n        userName: '',\n        userGender: '',\n        userAddress: '',\n        userEmail: '',\n        userInfo: ''\n      },\n      oldPassword: '',\n      newPassword: '',\n      confirmPassword: '',\n      saying: '书山有路勤为径，学海无涯苦作舟'\n    };\n  },\n  methods: {\n    getSaying() {\n      fetch('https://api.uixsj.cn/hitokoto/get').then(res => res.text()).then(text => {\n        this.saying = text;\n      });\n    },\n    showEdit() {\n      this.onEdit = !this.onEdit;\n      if (!this.onEdit) {\n        this.handleModify();\n      }\n    },\n    handleModify() {\n      this.$axios.post('/user/UpdateUserBasicInfoByUid', this.user).then(response => {\n        if (response.data.flag) {\n          this.$message.success(response.data.msg);\n        } else {\n          this.$message.error(response.data.msg);\n        }\n      });\n    },\n    getUserInfo() {\n      this.$axios.get(`/user/GetUserInfoByUid/${this.uid}`).then(response => {\n        if (response.data.flag) {\n          this.user = response.data.data;\n          this.$store.dispatch('saveUserInfo', this.user);\n        } else {\n          this.$message.error(response.data.msg);\n        }\n      });\n    },\n    updatePhoto(e) {\n      if (e.currentTarget.files.length === 0) {\n        return;\n      }\n      const formData = new FormData();\n      formData.append('photo', e.currentTarget.files[0]);\n      this.$axios.post(`/user/UpdateUserPhotoByUid/${this.uid}`, formData).then(response => {\n        if (response.data.flag) {\n          this.$message.success(response.data.msg);\n          this.getUserInfo();\n        } else {\n          this.$message.error(response.data.msg);\n        }\n      });\n    },\n    handleModifyPassword() {\n      if (this.newPassword != this.confirmPassword) {\n        this.$message.info('新密码与确认密码不一致');\n      } else {\n        const formData = new FormData();\n        formData.append('uId', this.uid);\n        formData.append('oldPassword', this.oldPassword);\n        formData.append('newPassword', this.newPassword);\n        this.$axios.post('/user/UpdateUserPasswordByUid', formData).then(response => {\n          if (response.data.flag) {\n            this.$message.success(response.data.msg);\n            this.dialogFormVisible = false;\n          } else {\n            this.$message.error(response.data.msg);\n          }\n        });\n      }\n    }\n  },\n  computed: {\n    uid() {\n      return this.$store.getters['getUserId'];\n    }\n  },\n  created() {\n    this.getSaying();\n    this.getUserInfo();\n  }\n};","map":{"version":3,"mappings":"AAmFA;EACAA;EACAC;IACA;MACAC;MACAC;MACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;MACA;MACAC;MACAC;MACAC;MACAC;IACA;EACA;EACAC;IACAC;MACAC;QACA;MACA;IACA;IACAC;MACA;MACA;QACA;MACA;IACA;IACAC;MACA;QACA;UACA;QACA;UACA;QACA;MACA;IACA;IACAC;MACA;QACA;UACA;UACA;QACA;UACA;QACA;MACA;IACA;IACAC;MACA;QACA;MACA;MACA;MACAC;MACA;QACA;UACA;UACA;QACA;UACA;QACA;MACA;IACA;IACAC;MACA;QACA;MACA;QACA;QACAD;QACAA;QACAA;QACA;UACA;YACA;YACA;UACA;YACA;UACA;QACA;MACA;IACA;EACA;EACAE;IACAC;MACA;IACA;EACA;EACAC;IACA;IACA;EACA;AACA","names":["name","data","dialogFormVisible","onEdit","user","userId","userName","userGender","userAddress","userEmail","userInfo","oldPassword","newPassword","confirmPassword","saying","methods","getSaying","fetch","showEdit","handleModify","getUserInfo","updatePhoto","formData","handleModifyPassword","computed","uid","created"],"sourceRoot":"src/pages","sources":["UserInfo.vue"],"sourcesContent":["<template>\n  <div class=\"user\">\n    <div class=\"title\">\n        <span class=\"name\">Hello, {{ user.userName }}</span>\n        <el-tooltip class=\"item\" effect=\"dark\" :content=\"saying\" placement=\"top\">\n            <span class=\"saying\">{{ saying }}</span>\n        </el-tooltip>\n        \n    </div>\n    <div class=\"content\">\n       <div>Basic personal information</div>\n        <div class=\"row\">\n            <ul class=\"infos\">\n                <li>\n                    <span>UID</span><span>{{user.userId}}</span>\n                </li>\n                <li>\n                    <span>userName</span><span v-show=\"!onEdit\">{{user.userName}}</span><input v-model=\"user.userName\" type=\"text\" v-show=\"onEdit\">\n                </li>\n                <li>\n                    <span>gendar</span><span v-show=\"!onEdit\">{{user.userGender}}</span>\n                    <el-select style=\"width: 300px; height: 30px;\" v-model=\"user.userGender\" v-show=\"onEdit\">\n                        <el-option value=\"保密\"></el-option>\n                        <el-option value=\"男\"></el-option>\n                        <el-option value=\"女\"></el-option>\n                    </el-select>\n                </li>\n                <li>\n                    <span>地址</span><span v-show=\"!onEdit\">{{user.userAddress}}</span><input v-model=\"user.userAddress\" type=\"text\" v-show=\"onEdit\">\n                </li>\n                <li>\n                    <span>邮箱</span><span v-show=\"!onEdit\">{{user.userEmail}}</span><input v-model=\"user.userEmail\" type=\"text\" v-show=\"onEdit\">\n                </li>\n                <li>\n                    <span>个人简介</span><span v-show=\"!onEdit\">{{user.userInfo}}</span>\n                    <el-input\n                    v-show=\"onEdit\"\n                    type=\"textarea\"\n                    placeholder=\"请输入内容\"\n                    maxlength=\"100\"\n                    v-model=\"user.userInfo\"\n                    show-word-limit\n                    style=\"width: 300px; vertical-align: top;\"\n                    >\n                    </el-input>\n                </li>\n            </ul>\n            <div class=\"right\">\n                <div class=\"photo\">\n                    <label>\n                        <input type=\"file\" name=\"\" id=\"\" style=\"display: none;\" @change=\"updatePhoto\" accept=\"image/*\">\n                        <img :src=\"user.userImage\" alt=\"\" srcset=\"\">\n                    </label>\n                    <span class=\"tips\">点击上传图片</span>\n                </div>\n                <div class=\"opts\">\n                    <button class=\"change-pwd btn\" @click=\"dialogFormVisible = true\">修改密码</button>\n                    <button class=\"edit-info btn\" @click=\"showEdit\">{{ onEdit ? '保存更改' : '编辑信息' }}</button>\n                </div>\n            </div>\n        </div>\n    </div>\n    <el-dialog title=\"修改密码\" :visible.sync=\"dialogFormVisible\">\n        <el-form label-width=\"80px\">\n            <el-form-item label=\"原密码\">\n                <el-input v-model=\"oldPassword\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"新密码\">\n                <el-input v-model=\"newPassword\"></el-input>\n            </el-form-item>\n            <el-form-item label=\"确认密码\">\n                <el-input v-model=\"confirmPassword\"></el-input>\n            </el-form-item>\n        </el-form>\n        <div slot=\"footer\" class=\"dialog-footer\">\n            <el-button @click=\"addDialogFormVisible = false\">取 消</el-button>\n            <el-button type=\"primary\" @click=\"handleModifyPassword\">确 定</el-button>\n        </div>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nexport default {\n    name: 'UserInfo',\n    data() {\n        return {\n            dialogFormVisible: false,\n            onEdit: false,\n            user: {\n                userId: '',\n                userName: '',\n                userGender: '',\n                userAddress: '',\n                userEmail: '',\n                userInfo: ''\n            },\n            oldPassword: '',\n            newPassword: '',\n            confirmPassword: '',\n            saying: '书山有路勤为径，学海无涯苦作舟'\n        }\n    },\n    methods: {\n        getSaying() {\n            fetch('https://api.uixsj.cn/hitokoto/get').then(res => res.text()).then(text => {\n                this.saying = text\n            })\n        },\n        showEdit() {\n            this.onEdit = !this.onEdit\n            if (!this.onEdit) {\n                this.handleModify()\n            }\n        },\n        handleModify() {\n            this.$axios.post('/user/UpdateUserBasicInfoByUid', this.user).then(response => {\n                if (response.data.flag) {\n                    this.$message.success(response.data.msg)\n                } else {\n                    this.$message.error(response.data.msg)\n                }\n            })\n        },\n        getUserInfo() {\n            this.$axios.get(`/user/GetUserInfoByUid/${this.uid}`).then(response => {\n                if (response.data.flag) {\n                    this.user = response.data.data\n                    this.$store.dispatch('saveUserInfo', this.user)\n                } else {\n                    this.$message.error(response.data.msg)\n                }\n            })\n        },\n        updatePhoto(e) {\n            if (e.currentTarget.files.length === 0) {\n                return\n            }\n            const formData = new FormData()\n            formData.append('photo', e.currentTarget.files[0])\n            this.$axios.post(`/user/UpdateUserPhotoByUid/${this.uid}`, formData).then(response => {\n                if (response.data.flag) {\n                    this.$message.success(response.data.msg)\n                    this.getUserInfo()\n                } else {\n                    this.$message.error(response.data.msg)\n                }\n            })\n        },\n        handleModifyPassword() {\n            if (this.newPassword != this.confirmPassword) {\n                this.$message.info('新密码与确认密码不一致')\n            } else {\n                const formData = new FormData()\n                formData.append('uId', this.uid)\n                formData.append('oldPassword', this.oldPassword)\n                formData.append('newPassword', this.newPassword)\n                this.$axios.post('/user/UpdateUserPasswordByUid', formData).then(response => {\n                    if (response.data.flag) {\n                        this.$message.success(response.data.msg)\n                        this.dialogFormVisible = false\n                    } else {\n                        this.$message.error(response.data.msg)\n                    }\n                })\n            }\n        }\n    },\n    computed: {\n        uid() {\n            return this.$store.getters['getUserId']\n        }\n    },\n    created() {\n        this.getSaying()\n        this.getUserInfo()\n    }\n}\n</script>\n\n<style scoped>\n.title {\n    display: flex;\n    justify-content: space-between;\n    align-items: flex-end;\n    margin-bottom: 20px;\n}\n\n.name {\n    font-size: 24px;\n}\n\n.saying {\n    overflow: hidden;\n    display: inline-block;\n    font-size: 14px;\n    color: rgb(108, 108, 108);\n    /* background-color: red; */\n    max-width: 400px;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n}\n\n.content {\n    min-width: 620px;\n    padding: 12px;\n    border: 1px solid #ccc;\n    border-radius: 10px;\n}\n\n.content>div:first-child {\n    font-size: 14px;\n    color: rgb(26, 26, 26);\n    margin-bottom: 30px;\n}\n\n.row {\n    display: flex;\n}\n\n.infos li {\n    min-width: 400px;\n    height: 30px;\n    line-height: 30px;\n    margin: 20px 0;\n    font-size: 16px;\n    /* background-color: red; */\n}\n\n.infos li:nth-child(3) {\n    height: 40px;\n    /* background-color: pink; */\n    line-height: 40px;\n}\n\n\n.infos li:last-child {\n    height: 54px;\n    /* background-color: red; */\n}\n\n.infos li span:first-child {\n    display: inline-block;\n    width: 100px;\n}\n\n.infos li span:nth-child(2) {\n    display: inline-block;\n    width: 300px;\n    /* background-color: red; */\n    \n}\n\n.infos li input {\n    outline: none;\n    /* border: none;\n    border-bottom: 1px solid #ccc; */\n    border-radius: 5px;\n    border: 1px solid #ddd;\n    height: 30px;\n    width: 300px;\n    font-size: 16px;\n    text-indent: 14px;\n    transition: all .3s;\n}\n\n.infos li input:hover {\n    border-color: #ccc;\n}\n\n.infos li input:focus {\n    border-color: #5a9cf8;\n}\n\n.right {\n    display: flex;\n    min-width: 162px;\n    flex-direction: column;\n    margin-left: 30px;\n    align-items: center;\n}\n\n.photo {\n    overflow: hidden;\n    position: relative;\n    width: 160px;\n    height: 160px;\n    border-radius: 50%;\n    margin-top: 20px;\n    margin-bottom: 80px;\n}\n\n.tips {\n    display: none;\n    position: absolute;\n    left: 0;\n    bottom: 0;\n    width: 100%;\n    height: 30px;\n    padding: 5px;\n    background-color: rgba(255, 255, 255, 0.1);\n    backdrop-filter: blur(5px);\n    -webkit-backdrop-filter: blur(5px);\n    font-size: 12px;\n    text-align: center;\n    color: #fff;\n}\n\n.photo:hover .tips {\n    display: block;\n\n}\n\n.photo:hover img {\n    filter: blur(5px) brightness(0.8);\n\n}\n.photo img {\n    width: 160px;\n    height: 160px;\n    border-radius: 50%;\n    transition: all .2s;\n}\n\n.opts button:first-child {\n    margin-right: 10px;\n}\n\n/* .el-input\n.el-input--suffix {\n    height: 30px !important;\n}\n\n.el-input input {\n    height: 30px;\n    line-height: 30px;\n} */\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}